<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MamaMag Placement Reservation</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Main Styles */
        :root {
            --primary-color: #ff69b4;
            --primary-light: rgba(255, 105, 180, 0.1);
            --text-color: #333;
            --bg-color: #f9f2f4;
            --card-bg: #fff;
            --border-color: #ddd;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header Styles */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        header img {
            max-width: 250px;
            margin-bottom: 15px;
        }
        
        header h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2rem;
            color: #666;
        }
        
        /* Card Styles */
        .card {
            background: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .card h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-light);
        }
        
        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .required:after {
            content: " *";
            color: var(--primary-color);
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .char-counter {
            display: block;
            text-align: right;
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        /* Magazine Layout Styles */
        .magazine-layout {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .page {
            position: relative;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            height: 220px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background-color: #fff;
        }
        
        .page:hover:not(.unavailable) {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.2);
        }
        
        .page.selected {
            border-color: var(--primary-color);
            background-color: var(--primary-light);
            box-shadow: 0 5px 15px rgba(255, 105, 180, 0.3);
        }
        
        .page.unavailable {
            background-color: #f8f8f8;
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .page-number {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .page-info {
            margin-top: auto;
        }
        
        .page-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .premium-tag {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.7rem;
            margin-right: 5px;
        }
        
        .page-price {
            font-weight: 500;
            margin-top: 5px;
        }
        
        .reserved-by {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            font-style: italic;
        }
        
        /* Placement Details Form (Hidden by default) */
        #placement-details {
            display: none;
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            border-left: 4px solid var(--primary-color);
        }
        
        #placement-details h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        /* Checkbox style */
        .checkbox-group {
            display: flex;
            align-items: center;
        }
        
        .checkbox-group input {
            width: auto;
            margin-right: 10px;
        }
        
        .checkbox-group label {
            display: inline;
            cursor: pointer;
        }
        
        /* Button Styles */
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            background-color: #ff45a1;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.3);
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
            color: #222;
        }
        
        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* Summary Section Styles */
        .summary-section {
            margin-top: 40px;
        }
        
        .summary-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .summary-table th {
            background-color: #f5f5f5;
            text-align: left;
            padding: 12px 15px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .summary-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .summary-table tr:last-child td {
            border-bottom: none;
        }
        
        .summary-total {
            text-align: right;
            margin-top: 20px;
            font-size: 1.2rem;
        }
        
        .summary-total span {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.4rem;
        }
        
        /* File Upload Styles */
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .file-upload:hover {
            border-color: var(--primary-color);
        }
        
        .file-upload input {
            display: none;
        }
        
        .file-upload label {
            cursor: pointer;
            display: block;
            margin: 0;
        }
        
        .file-upload-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #888;
        }
        
        .file-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .file-item {
            background-color: #f5f5f5;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
        }
        
        .file-item .remove-file {
            margin-left: 8px;
            cursor: pointer;
            color: #999;
            font-weight: bold;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .magazine-layout {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
            
            .card {
                padding: 20px;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
        
        /* Loading Indicator */
        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Success/Error Messages */
        .message {
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="mamamag-logo.png" alt="MamaMag Logo">
            <h1>MamaMag Placement Reservation</h1>
            <p>Spring 2025 Edition - Maternity in Style</p>
        </header>
        
        <form id="reservation-form">
            <!-- Brand Information Section -->
            <div class="card">
                <h2>Brand Information</h2>
                <div class="form-group">
                    <label for="brand-name" class="required">Brand Name</label>
                    <input type="text" id="brand-name" name="brandName" required>
                </div>
                
                <div class="form-group">
                    <label for="contact-name" class="required">Contact Name</label>
                    <input type="text" id="contact-name" name="contactName" required>
                </div>
                
                <div class="form-group">
                    <label for="contact-email" class="required">Contact Email</label>
                    <input type="email" id="contact-email" name="contactEmail" required>
                </div>
                
                <div class="form-group">
                    <label for="mailing-address" class="required">Mailing Address</label>
                    <textarea id="mailing-address" name="mailingAddress" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="brand-logo" class="required">Brand Logo</label>
                    <div class="file-upload">
                        <label for="brand-logo">
                            <div class="file-upload-icon">üìÅ</div>
                            <p>Click to upload your logo (SVG or PNG)</p>
                        </label>
                        <input type="file" id="brand-logo" name="brandLogo" accept=".svg,.png">
                    </div>
                    <div class="file-list" id="logo-file-list"></div>
                </div>
                
                <div class="form-group">
                    <label for="brand-url" class="required">Brand Website</label>
                    <input type="url" id="brand-url" name="brandUrl" placeholder="https://yourbrand.com" required>
                </div>
            </div>
            
            <!-- Magazine Layout Selection Section -->
            <div class="card">
                <h2>Select Your Placement(s)</h2>
                <p>Click on a page to select it and provide your content details. Real-time availability is shown below.</p>
                
                <div class="magazine-layout" id="magazine-layout">
                    <!-- Pages will be dynamically generated here via JavaScript -->
                </div>
                
                <!-- Placement Details Form (Hidden until page is selected) -->
                <div id="placement-details">
                    <h3>Placement Details: <span id="selected-page-name">Front Cover</span></h3>
                    <input type="hidden" id="selected-page-id" name="selectedPageId">
                    
                    <div class="form-group">
                        <label for="product-name" class="required">Product Name</label>
                        <input type="text" id="product-name" name="productName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-price" class="required">Product Price</label>
                        <input type="text" id="product-price" name="productPrice" placeholder="$99.99" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-copy" class="required">Product Copy (max 75 characters)</label>
                        <textarea id="product-copy" name="productCopy" rows="2" maxlength="75" required></textarea>
                        <span class="char-counter" id="copy-counter">0/75 characters</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-url" class="required">Product URL</label>
                        <input type="url" id="product-url" name="productUrl" placeholder="https://yourbrand.com/product" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="product-images" class="required">Product Images</label>
                        <div class="file-upload">
                            <label for="product-images">
                                <div class="file-upload-icon">üì∏</div>
                                <p>Upload lifestyle and/or siloed product images</p>
                            </label>
                            <input type="file" id="product-images" name="productImages" accept="image/*" multiple required>
                        </div>
                        <div class="file-list" id="images-file-list"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="discount-code">Discount/Coupon Code (optional)</label>
                        <input type="text" id="discount-code" name="discountCode" placeholder="MAMA25">
                    </div>
                    
                    <div class="form-group">
                        <label for="utm-params">UTM Parameters (optional)</label>
                        <input type="text" id="utm-params" name="utmParams" placeholder="utm_source=mamamag&utm_medium=print&utm_campaign=spring2025">
                    </div>
                    
                    <div class="form-group">
                        <label for="article-copy">Long-form/Article Copy (optional, max 700 characters)</label>
                        <textarea id="article-copy" name="articleCopy" rows="5" maxlength="700"></textarea>
                        <span class="char-counter" id="article-counter">0/700 characters</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="page-title">Page Title (optional)</label>
                        <input type="text" id="page-title" name="pageTitle" placeholder="Spring Essentials">
                    </div>
                    
                    <div class="form-group checkbox-group">
                        <input type="checkbox" id="copy-writing" name="copyWriting">
                        <label for="copy-writing">Would you like our team to write your copy? (+$50)</label>
                    </div>
                    
                    <div class="btn-group">
                        <button type="button" class="btn" id="add-placement-btn">Add This Placement</button>
                        <button type="button" class="btn btn-secondary" id="cancel-placement-btn">Cancel</button>
                    </div>
                </div>
            </div>
            
            <!-- Summary Section -->
            <div class="card summary-section">
                <h2>Your Selected Placements</h2>
                <div id="empty-selection-message">
                    <p>No placements selected yet. Click on a page in the magazine layout above to add a placement.</p>
                </div>
                
                <table class="summary-table" id="summary-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Page</th>
                            <th>Placement Type</th>
                            <th>Product</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="summary-body">
                        <!-- Selected placements will appear here -->
                    </tbody>
                </table>
                
                <div class="summary-total">
                    Total: <span id="total-price">$0</span>
                </div>
                
                <div class="message success" id="success-message">
                    Your reservation has been submitted successfully!
                </div>
                
                <div class="message error" id="error-message">
                    There was an error submitting your reservation. Please try again.
                </div>
                
                <div class="loader" id="loader">
                    <div class="spinner"></div>
                    <p>Submitting your reservation...</p>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn" id="submit-btn">Submit Reservation</button>
                </div>
            </div>
        </form>
    </div>
    
    <script>
        // Magazine Layout Data - This would be fetched from Google Sheets in production
        const magazineData = {
            campaignId: "MM-SP25",
            campaignName: "Spring 2025 - Maternity in Style",
            pages: [
                {
                    id: "cover",
                    pageNumber: "Cover",
                    name: "Front Cover Feature",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 10000,
                    available: true
                },
                {
                    id: "ifc",
                    pageNumber: "1",
                    name: "Inside Front Cover",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 7000,
                    available: true
                },
                {
                    id: "page-2",
                    pageNumber: "2",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true
                },
                {
                    id: "page-3",
                    pageNumber: "3",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true
                },
                {
                    id: "spread-4-5",
                    pageNumber: "4-5",
                    name: "Two-Page Spread",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 5000,
                    available: true
                },
                {
                    id: "page-6",
                    pageNumber: "6",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: false,
                    reservedBy: "Caden Lane"
                },
                {
                    id: "page-7",
                    pageNumber: "7",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true
                },
                {
                    id: "spread-8-9",
                    pageNumber: "8-9",
                    name: "Center Spread",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 8000,
                    available: true
                },
                {
                    id: "page-10",
                    pageNumber: "10",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true
                },
                {
                    id: "page-11",
                    pageNumber: "11",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true
                },
                {
                    id: "page-12",
                    pageNumber: "12",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: false,
                    reservedBy: "Kindred Bravely"
                },
                {
                    id: "page-13",
                    pageNumber: "13",
                    name: "Standard Full Page",
                    type: "Standard",
                    basePrice: 7500,
                    additionalPremium: 0,
                    available: true
                },
                {
                    id: "back-cover",
                    pageNumber: "Back",
                    name: "Back Cover",
                    type: "Premium",
                    basePrice: 7500,
                    additionalPremium: 7000,
                    available: true
                }
            ]
        };
        
        // Store the selected placements
        const selectedPlacements = {};
        
        // DOM Elements
        const magazineLayout = document.getElementById('magazine-layout');
        const placementDetails = document.getElementById('placement-details');
        const selectedPageName = document.getElementById('selected-page-name');
        const selectedPageId = document.getElementById('selected-page-id');
        const addPlacementBtn = document.getElementById('add-placement-btn');
        const cancelPlacementBtn = document.getElementById('cancel-placement-btn');
        const summaryTable = document.getElementById('summary-table');
        const summaryBody = document.getElementById('summary-body');
        const emptySelectionMessage = document.getElementById('empty-selection-message');
        const totalPriceElement = document.getElementById('total-price');
        const productCopy = document.getElementById('product-copy');
        const copyCounter = document.getElementById('copy-counter');
        const articleCopy = document.getElementById('article-copy');
        const articleCounter = document.getElementById('article-counter');
        const reservationForm = document.getElementById('reservation-form');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const loader = document.getElementById('loader');
        
        // File Upload Elements
        const brandLogo = document.getElementById('brand-logo');
        const logoFileList = document.getElementById('logo-file-list');
        const productImages = document.getElementById('product-images');
        const imagesFileList = document.getElementById('images-file-list');
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderMagazineLayout();
            setupEventListeners();
        });
        
        // Render the magazine layout
        function renderMagazineLayout() {
            magazineLayout.innerHTML = '';
            
            magazineData.pages.forEach(page => {
                const pageElement = document.createElement('div');
                pageElement.className = 'page';
                pageElement.id = page.id;
                
                if (!page.available) {
                    pageElement.classList.add('unavailable');
                }
                
                if (selectedPlacements[page.id]) {
                    pageElement.classList.add('selected');
                }
                
                pageElement.innerHTML = `
                    <div class="page-number">${page.pageNumber}</div>
                    <div class="page-info">
                        <div class="page-title">${page.name}</div>
                        ${page.type === 'Premium' ? '<span class="premium-tag">Premium</span>' : ''}
                        <div class="page-price">${(page.basePrice + page.additionalPremium).toLocaleString()}</div>
                        ${!page.available ? `<div class="reserved-by">Reserved by: ${page.reservedBy}</div>` : ''}
                    </div>
                `;
                
                if (page.available) {
                    pageElement.addEventListener('click', () => selectPage(page));
                }
                
                magazineLayout.appendChild(pageElement);
            });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Character counters
            productCopy.addEventListener('input', () => {
                copyCounter.textContent = `${productCopy.value.length}/75 characters`;
            });
            
            articleCopy.addEventListener('input', () => {
                articleCounter.textContent = `${articleCopy.value.length}/700 characters`;
            });
            
            // Add placement button
            addPlacementBtn.addEventListener('click', addPlacement);
            
            // Cancel placement button
            cancelPlacementBtn.addEventListener('click', cancelPlacement);
            
            // File upload for brand logo
            brandLogo.addEventListener('change', () => {
                handleFileUpload(brandLogo, logoFileList);
            });
            
            // File upload for product images
            productImages.addEventListener('change', () => {
                handleFileUpload(productImages, imagesFileList, true);
            });
            
            // Form submission
            reservationForm.addEventListener('submit', submitReservation);
        }
        
        // Select a page in the magazine
        function selectPage(page) {
            // If this page is already selected, show its details
            if (selectedPlacements[page.id]) {
                populatePlacementForm(selectedPlacements[page.id]);
            } else {
                // Reset the form fields
                document.getElementById('product-name').value = '';
                document.getElementById('product-price').value = '';
                document.getElementById('product-copy').value = '';
                copyCounter.textContent = '0/75 characters';
                document.getElementById('product-url').value = '';
                document.getElementById('discount-code').value = '';
                document.getElementById('utm-params').value = '';
                document.getElementById('article-copy').value = '';
                articleCounter.textContent = '0/700 characters';
                document.getElementById('page-title').value = '';
                document.getElementById('copy-writing').checked = false;
                imagesFileList.innerHTML = '';
            }
            
            // Update the selected page info
            selectedPageName.textContent = page.name;
            selectedPageId.value = page.id;
            
            // Show the placement details form
            placementDetails.style.display = 'block';
            
            // Scroll to the form
            placementDetails.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Populate the placement form with existing data
        function populatePlacementForm(placement) {
            document.getElementById('product-name').value = placement.productName;
            document.getElementById('product-price').value = placement.productPrice;
            document.getElementById('product-copy').value = placement.productCopy;
            copyCounter.textContent = `${placement.productCopy.length}/75 characters`;
            document.getElementById('product-url').value = placement.productUrl;
            document.getElementById('discount-code').value = placement.discountCode || '';
            document.getElementById('utm-params').value = placement.utmParams || '';
            document.getElementById('article-copy').value = placement.articleCopy || '';
            articleCounter.textContent = `${placement.articleCopy ? placement.articleCopy.length : 0}/700 characters`;
            document.getElementById('page-title').value = placement.pageTitle || '';
            document.getElementById('copy-writing').checked = placement.copyWriting || false;
            
            // Note: File uploads can't be repopulated easily in HTML
            // In production, you'd show a list of already uploaded files
        }
        
        // Add a placement to the selection
        function addPlacement() {
            const pageId = selectedPageId.value;
            const page = magazineData.pages.find(p => p.id === pageId);
            
            if (!page) return;
            
            // Validate the form
            const productName = document.getElementById('product-name').value;
            const productPrice = document.getElementById('product-price').value;
            const productCopyValue = document.getElementById('product-copy').value;
            const productUrl = document.getElementById('product-url').value;
            
            if (!productName || !productPrice || !productCopyValue || !productUrl) {
                alert('Please fill in all required fields for this placement.');
                return;
            }
            
            // Create a placement object
            const placement = {
                pageId: pageId,
                pageName: page.name,
                pageNumber: page.pageNumber,
                pageType: page.type,
                basePrice: page.basePrice,
                additionalPremium: page.additionalPremium,
                totalPrice: page.basePrice + page.additionalPremium,
                productName: productName,
                productPrice: productPrice,
                productCopy: productCopyValue,
                productUrl: productUrl,
                discountCode: document.getElementById('discount-code').value,
                utmParams: document.getElementById('utm-params').value,
                articleCopy: document.getElementById('article-copy').value,
                pageTitle: document.getElementById('page-title').value,
                copyWriting: document.getElementById('copy-writing').checked,
                timestamp: new Date().toISOString()
            };
            
            // Add copywriting fee if selected
            if (placement.copyWriting) {
                placement.totalPrice += 50;
            }
            
            // Add to the selected placements
            selectedPlacements[pageId] = placement;
            
            // Update the magazine layout
            renderMagazineLayout();
            
            // Update the summary table
            updateSummary();
            
            // Hide the placement details form
            placementDetails.style.display = 'none';
        }
        
        // Cancel the placement selection
        function cancelPlacement() {
            // Hide the placement details form
            placementDetails.style.display = 'none';
        }
        
        // Handle file uploads
        function handleFileUpload(inputElement, listElement, multiple = false) {
            const files = inputElement.files;
            listElement.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    ${file.name}
                    <span class="remove-file">√ó</span>
                `;
                
                // Add remove functionality
                const removeBtn = fileItem.querySelector('.remove-file');
                removeBtn.addEventListener('click', () => {
                    // In production, you'd need to handle file removal properly
                    // This is just a simple UI demonstration
                    fileItem.remove();
                    
                    // If there are no files left, clear the input
                    if (listElement.children.length === 0) {
                        inputElement.value = '';
                    }
                });
                
                listElement.appendChild(fileItem);
                
                // If it's not a multiple file upload, only show the first file
                if (!multiple) break;
            }
        }
        
        // Update the summary table
        function updateSummary() {
            const placements = Object.values(selectedPlacements);
            
            if (placements.length > 0) {
                emptySelectionMessage.style.display = 'none';
                summaryTable.style.display = 'table';
                
                summaryBody.innerHTML = '';
                let totalPrice = 0;
                
                placements.forEach(placement => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${placement.pageNumber}</td>
                        <td>${placement.pageType}</td>
                        <td>${placement.productName}</td>
                        <td>${placement.totalPrice.toLocaleString()}</td>
                        <td>
                            <button type="button" class="btn btn-secondary" data-page-id="${placement.pageId}">Remove</button>
                        </td>
                    `;
                    
                    // Add event listener to the remove button
                    const removeBtn = row.querySelector('button');
                    removeBtn.addEventListener('click', () => removePlacement(placement.pageId));
                    
                    summaryBody.appendChild(row);
                    totalPrice += placement.totalPrice;
                });
                
                // Update the total price
                totalPriceElement.textContent = `${totalPrice.toLocaleString()}`;
            } else {
                emptySelectionMessage.style.display = 'block';
                summaryTable.style.display = 'none';
                totalPriceElement.textContent = '$0';
            }
        }
        
        // Remove a placement from the selection
        function removePlacement(pageId) {
            delete selectedPlacements[pageId];
            renderMagazineLayout();
            updateSummary();
        }
        
        // Submit the reservation
        function submitReservation(event) {
            event.preventDefault();
            
            // Validate that at least one placement is selected
            if (Object.keys(selectedPlacements).length === 0) {
                alert('Please select at least one placement before submitting.');
                return;
            }
            
            // Collect the form data
            const formData = {
                campaignId: magazineData.campaignId,
                campaignName: magazineData.campaignName,
                brandName: document.getElementById('brand-name').value,
                contactName: document.getElementById('contact-name').value,
                contactEmail: document.getElementById('contact-email').value,
                mailingAddress: document.getElementById('mailing-address').value,
                brandUrl: document.getElementById('brand-url').value,
                placements: Object.values(selectedPlacements),
                totalPrice: Object.values(selectedPlacements).reduce((total, p) => total + p.totalPrice, 0),
                submissionDate: new Date().toISOString()
            };
            
            // Show the loader
            loader.style.display = 'block';
            
            // Hide any previous messages
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            // In production, this would be an actual AJAX request to submit the data
            // For this demonstration, we'll simulate a successful submission after a delay
            setTimeout(() => {
                // Simulate form submission to Google Sheets (in production this would be an actual API call)
                submitToGoogleSheets(formData)
                    .then(response => {
                        // Hide the loader
                        loader.style.display = 'none';
                        
                        if (response.success) {
                            // Show success message
                            successMessage.style.display = 'block';
                            
                            // Reset the form and selection
                            resetForm();
                        } else {
                            // Show error message
                            errorMessage.textContent = response.error || 'There was an error submitting your reservation. Please try again.';
                            errorMessage.style.display = 'block';
                        }
                    })
                    .catch(error => {
                        // Hide the loader
                        loader.style.display = 'none';
                        
                        // Show error message
                        errorMessage.textContent = 'There was an error connecting to the server. Please try again later.';
                        errorMessage.style.display = 'block';
                        console.error('Error:', error);
                    });
            }, 1500); // Simulate network delay
        }
        
        // Function to submit data to Google Sheets (mock function for demonstration)
        function submitToGoogleSheets(formData) {
            // In production, this would be an actual API call to a Google Apps Script endpoint
            // For this demonstration, we'll simulate a successful response
            return new Promise((resolve) => {
                // Simulate successful submission
                resolve({
                    success: true,
                    message: 'Reservation submitted successfully!',
                    reservationId: 'MM-' + Math.floor(100000 + Math.random() * 900000)
                });
                
                // To simulate an error, uncomment this:
                /*
                resolve({
                    success: false,
                    error: 'Server is currently unavailable. Please try again later.'
                });
                */
            });
        }
        
        // Reset the form and selection
        function resetForm() {
            // Clear the form fields
            document.getElementById('brand-name').value = '';
            document.getElementById('contact-name').value = '';
            document.getElementById('contact-email').value = '';
            document.getElementById('mailing-address').value = '';
            document.getElementById('brand-url').value = '';
            brandLogo.value = '';
            logoFileList.innerHTML = '';
            
            // Clear the selected placements
            Object.keys(selectedPlacements).forEach(key => delete selectedPlacements[key]);
            
            // Update the magazine layout
            renderMagazineLayout();
            
            // Update the summary
            updateSummary();
            
            // Hide the placement details form
            placementDetails.style.display = 'none';
        }
    </script>
</body>
</html>

                
